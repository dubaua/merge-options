{"version":3,"file":"merge-options.js","sources":["../src/utils/hasProperty.js","../src/merge-options.js","../src/index.js"],"sourcesContent":["function hasProperty(object, property) {\n  return Object.prototype.hasOwnProperty.call(object, property);\n}\n\nexport default hasProperty;\n","import hasProperty from '@/utils/hasProperty.js';\n\n/**\n * @typedef {Object} Option\n * @property {boolean|function} required - a flag or function accepts userOptions\n * @property {*} default - default value for fallback if user option fail validation\n * @property {function} validator - function for validating user option. Accepts userValue as first argument and userOptions as second. Should return boolean value\n * @property {string} description - human readable validator description. Uses to compose an error message and warning\n */\n\n/**\n * Uses option configuration to iterate over passed user options.\n * Returns an object with user options passed validation and/or default not required values.\n * Throws an error for every missing required option.\n * Fallback to default value to every not required option.\n * If user value fails validation throws an error in strict mode or otherwise shows a warning message and fallback to default value.\n * All errors and warnings are verbose and composed based on description of options.\n * @param {Object} config - required configuration\n * @param {Object.<string, Option>} config.optionConfig - declarative option configuration\n * @param {Object} [config.userOptions={}] - user options needs validation before merge\n * @param {string} [config.preffix=''] - string before an error or warning message\n * @param {string} [config.suffix=''] - string after an error or warning message\n * @param {boolean} [config.strict=true] - strict mode flag. Default = true.\n * In strict mode the function throws an error, when user option fails validaton.\n * Otherwise the function shows warning message and fallback to default value.\n * @return {Object} an object with all keys described in options with userOption values if they pass validation and/or default not required values.\n */\n\nfunction _mergeOptions({ optionConfig, userOptions = {}, preffix = '', suffix = '', strict = true }) {\n  const createMessage = (message) => [preffix, message, suffix].join(' ');\n\n  const mergedOptions = {};\n\n  // iterate over optionConfig to merge only options described in config\n  for (const optionKey in optionConfig) {\n    if (hasProperty(optionConfig, optionKey)) {\n      const optionPropertyConfig = optionConfig[optionKey];\n      const { required, default: _default, description, validator } = optionPropertyConfig;\n      const userValue = userOptions[optionKey];\n\n      // required can be function\n      const isRequired = hasProperty(optionPropertyConfig, 'required')\n        ? typeof required === 'function'\n          ? required(userOptions)\n          : required\n        : false;\n\n      const isUserOptionPassed = hasProperty(userOptions, optionKey);\n\n      const isValid = validator(userValue, userOptions);\n\n      if (isRequired) {\n        if (isUserOptionPassed) {\n          if (isValid) {\n            mergedOptions[optionKey] = userValue;\n          } else {\n            throw new TypeError(\n              createMessage(`Expected ${optionKey} to be ${description}, got ${typeof userValue} ${userValue}.`),\n            );\n          }\n        } else {\n          throw new TypeError(createMessage(`${optionKey} is required.`));\n        }\n      } else {\n        mergedOptions[optionKey] = _default;\n        if (isUserOptionPassed) {\n          if (isValid) {\n            mergedOptions[optionKey] = userValue;\n          } else {\n            if (strict) {\n              throw new TypeError(\n                createMessage(`Expected ${optionKey} to be ${description}, got ${typeof userValue} ${userValue}.`),\n              );\n            } else {\n              console.warn(\n                createMessage(\n                  `Expected ${optionKey} to be ${description}, got ${typeof userValue} ${userValue}. Fallback to default value ${_default}.`,\n                ),\n              );\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return mergedOptions;\n}\n\nexport default _mergeOptions;\n","import hasProperty from '@/utils/hasProperty.js';\nimport _mergeOptions from '@/merge-options.js';\n\nconst MESSAGE_PREFFIX = '[mergeOptions]:';\nconst MESSAGE_SUFFIX = '\\nCheck out documentation https://github.com/dubaua/merge-options#parameters-and-return';\n\nfunction isObject(value) {\n  return value !== null && typeof value === 'object' && Array.isArray(value) === false;\n}\n\nfunction throwTypeError(message) {\n  throw new TypeError([MESSAGE_PREFFIX, message, MESSAGE_SUFFIX].join(' '));\n}\n\nfunction optionConfigValidator(optionConfig) {\n  for (const key in optionConfig) {\n    if (hasProperty(optionConfig, key)) {\n      const optionPropertyConfig = optionConfig[key];\n\n      if (!isObject(optionPropertyConfig)) {\n        throwTypeError(\n          `Expected optionConfig.${key} to be an object with declarative option configuration, got ${typeof optionPropertyConfig} ${optionPropertyConfig}.`,\n        );\n      }\n\n      if (hasProperty(optionPropertyConfig, 'required')) {\n        const required = optionPropertyConfig.required;\n        const requiredType = typeof required;\n        if (!(requiredType === 'boolean' || requiredType === 'function')) {\n          throwTypeError(\n            `Expected optionConfig.${key}.required to be either boolean or function, got ${typeof required} ${required}.`,\n          );\n        }\n      } else {\n        if (!hasProperty(optionPropertyConfig, 'default')) {\n          throwTypeError(`Expected optionConfig.${key} to either have required or default value.`);\n        }\n      }\n\n      if (!hasProperty(optionPropertyConfig, 'default') && !hasProperty(optionPropertyConfig, 'required')) {\n        throwTypeError(`Expected optionConfig.${key} to either have required or default value.`);\n      }\n\n      if (hasProperty(optionPropertyConfig, 'description')) {\n        const description = optionPropertyConfig.description;\n        if (typeof optionPropertyConfig.description !== 'string') {\n          throwTypeError(\n            `Expected optionConfig.${key}.description to be a string, got ${typeof description} ${description}.`,\n          );\n        }\n      } else {\n        throwTypeError(`Missing description on optionConfig.${key} config.`);\n      }\n\n      if (hasProperty(optionPropertyConfig, 'validator')) {\n        const validator = optionPropertyConfig.validator;\n        if (typeof optionPropertyConfig.validator !== 'function') {\n          throwTypeError(\n            `Expected optionConfig.${key}.validator to be a function, got ${typeof validator} ${validator}.`,\n          );\n        }\n      } else {\n        throwTypeError(`Missing validator on optionConfig.${key} config.`);\n      }\n    }\n  }\n  return isObject(optionConfig);\n}\n\nconst OPTION_CONFIG = {\n  optionConfig: {\n    required: true,\n    validator: optionConfigValidator,\n    description: 'an object with declarative option configuration',\n  },\n  userOptions: {\n    required: false,\n    default: {},\n    validator: isObject,\n    description: 'an object',\n  },\n  preffix: {\n    required: false,\n    default: '',\n    validator: (x) => typeof x === 'string',\n    description: 'a string',\n  },\n  suffix: {\n    required: false,\n    default: '',\n    validator: (x) => typeof x === 'string',\n    description: 'a string',\n  },\n  strict: {\n    required: false,\n    default: true,\n    validator: (x) => typeof x === 'boolean',\n    description: 'a boolean',\n  },\n};\n\n/**\n * @typedef {Object} Option\n * @property {boolean|function} required - a flag or function accepts userOptions\n * @property {*} default - default value for fallback if user option fail validation\n * @property {function} validator - function for validating user option. Accepts userValue as first argument and userOptions as second. Should return boolean value\n * @property {string} description - human readable validator description. Uses to compose an error message and warning\n */\n\n/**\n * Uses option configuration to iterate over passed user options.\n * Returns an object with user options passed validation and/or default not required values.\n * Throws an error for every missing required option.\n * Fallback to default value to every not required option.\n * If user value fails validation throws an error in strict mode or otherwise shows a warning message and fallback to default value.\n * All errors and warnings are verbose and composed based on description of options.\n * @param {Object} config - required configuration\n * @param {Object.<string, Option>} config.optionConfig - declarative option configuration\n * @param {Object} [config.userOptions={}] - user options needs validation before merge\n * @param {string} [config.preffix=''] - string before an error or warning message\n * @param {string} [config.suffix=''] - string after an error or warning message\n * @param {boolean} [config.strict=true] - strict mode flag. Default = true\n * In strict mode the function throws an error, when user option fails validaton.\n * Otherwise the function shows warning message and fallback to default value.\n * @return {Object} an object with all keys described in options with userOption values if they pass validation and/or default not required values.\n */\n\nfunction mergeOptions(config) {\n  const validConfig = _mergeOptions({\n    optionConfig: OPTION_CONFIG,\n    userOptions: config,\n    preffix: MESSAGE_PREFFIX,\n    suffix: MESSAGE_SUFFIX,\n  });\n  return _mergeOptions(validConfig);\n}\n\nexport default mergeOptions;\n"],"names":["hasProperty","object","property","Object","prototype","hasOwnProperty","call","_mergeOptions","optionConfig","userOptions","preffix","suffix","strict","createMessage","message","join","mergedOptions","optionKey","optionPropertyConfig","required","_default","description","validator","userValue","isRequired","isUserOptionPassed","isValid","TypeError","console","warn","MESSAGE_PREFFIX","MESSAGE_SUFFIX","isObject","value","Array","isArray","throwTypeError","OPTION_CONFIG","key","requiredType","default","x","config","validConfig"],"mappings":"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"}